# Expects binary output `$relay`, binary sensor `$switch`, and Home Assistant
# entity ID `$target`
---
switch:
  - platform: output
    internal: true
    restore_mode: ALWAYS_ON
    id: relay
    output: $relay

binary_sensor:
  - platform: status
    # Once the API has reconnected, the light needs to be powered.
    on_press:
      - switch.turn_on: relay
    # When API gets disconnected, the light needs to be powered.
    on_release:
      - switch.turn_on: relay
# This seems to be behavior which was *supposed* to work, however currently
# it does not. Until this is fixed, we'll have to create a new binary sensor.
# - id: !extend $switch
  - platform: template
    id: switch_replace_me_when_fixed
    internal: true
    lambda: 'return id($button).state;'
    on_click:
      - if:
          condition:
            api.connected:
          then:
            - homeassistant.service:
                service: light.toggle
                data:
                  entity_id: $target
          else:
            - switch.toggle: relay
...
